# Tên của kịch bản
name: Deploy to Firebase Hosting on merge

# Kích hoạt: Chạy khi có code được đẩy lên (push) branch 'main'
on:
  push:
    branches:
      - main 

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest # Chạy trên máy ảo Ubuntu
    steps:
      # Bước 1: Lấy code của bạn từ GitHub
      - uses: actions/checkout@v4

      # Bước 2: Cài đặt Flutter (Đã sửa lỗi thụt đầu dòng)
      - uses: subosito/flutter-action@v2
        with: # 'with' phải thụt vào trong so với '- uses'
          flutter-version: '3.35.7' # Ghim cứng phiên bản giống máy của bạn

      # Bước 3: Build app Flutter Web
      - run: flutter build web --release --web-renderer canvaskit

      # Bước 4: Deploy lên Firebase Hosting
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_SAMPLE_FIREBASE_AI_APP_BDD63 }}
          channelId: live 
          projectId: sample-firebase-ai-app-bdd63
          target: admin-panel # Tên "target" trong file firebase.json